name: discord-notify

on:
  workflow_call:
    inputs:
      status:
        description: Result string from the upstream job (success/failure/cancelled)
        required: true
        type: string
      release_url:
        description: GitHub release URL (may be empty on failure)
        required: false
        default: ""
        type: string
      app_name:
        description: Application name
        required: true
        type: string
      version:
        description: Application version
        required: true
        type: string
      ref_name:
        description: Git reference name
        required: true
        type: string

permissions:
  contents: read

jobs:
  notify:
    if: ${{ secrets.DISCORD_WEBHOOK != '' }}
    runs-on: ubuntu-latest
    env:
      APP_NAME: ${{ inputs.app_name }}
      VERSION: ${{ inputs.version }}
      REF_NAME: ${{ inputs.ref_name }}
    steps:
      - name: Discord notify success
        if: ${{ inputs.status == 'success' }}
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ✅ **Release created**
            • App: **${{ env.APP_NAME }}** v${{ env.VERSION }}
            • Tag: `${{ env.REF_NAME }}`
            • Author: ${{ github.actor }}
            • Commit: `${{ github.sha }}`
            • Release: ${{ inputs.release_url }}
            • Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

      - name: Discord notify failure
        if: ${{ inputs.status != 'success' }}
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ❌ **Release failed**
            • App: **${{ env.APP_NAME }}** v${{ env.VERSION }}
            • Ref: `${{ env.REF_NAME }}`
            • Author: ${{ github.actor }}
            • Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
